import requests
import json
from subprocess import call
import time

def buzzAngle(song_id):
	url = 'http://bcm.buzzanglemusic.com/api/bcmws.cfc?method=GetSongHistoryData&api_key=BD54F472-0CF2-509D-BE5531A00F1842E2&country_code=US&market_id=-1'
	r = requests.get(url, params={
		'song_id': song_id
		})
	r = r.json()
	data = r['DATA']
	metadata = r['metadata']
	
	for i in data:
		i['artist'] = metadata['artist']
		i['title'] = metadata['title']
		i['keen'] = {}
		i['keen']['timestamp'] = i['start_date']

	#print(data)
	return data

def main():
	# proessed already: 52467171 , 39579013 , 39720734,49218374,37972722,5272926,44815666,5261639,35971533,35725122,709,46391049,2843,48728810,50140650,43892639,40661988,39879395,26408489,43235,41867474,1740293,2829,39999131,34664319,44673688,41937145,42923770,28844564,39805299,29231009,36393851,49411234,51757,39928486,27610227,12038920,1624,51535872,45180862,49217901,31293970,537,44798724,51749949,24401268,28720772,51358764,29656,2061,24120,43915957,46973549,1823,43644142,35311359,29791294,31293944,40375095,41800939,50750623,2972,49631883,50140836,35943189,45165630,26432804,598,41374844,2392716,50135965,37155528,520,42601351,35594323,41816586,3039900,41201895,2080,40083113,52826235,29860956,24233701,45182191,38609085,39541524,43210031,1617,43271298,43131136,35750757,40291331,37681306,45165624,41687947,43252509,30544,3273,44955667,40095349,40095792,2297881,24408884,2391031,1907537,45759394,43875740,11500,39653302,46391119,48575131,28720445,44955417,2122,36757166,36773,48695641,43274055,32085263,29666,39724895,1977,44881625,36465406,41396335,52655184,32976006,41658306,6757278,5262141,37171425,33812512,19602255,48873299,35876,36800750,1946,40375354,38238637,45105453,44222364,40375340,50133947,49409119,30754623,41937137,32665387,480,37840122,39038824,43245170,23947706,36223135,1831,41185277,37784000,43915964,52466729,41801847,52344317,41532966,6771427,36800426,17365,44254722,65138,508,11679933,52788474,38852949,51905334,34957061,42552015,37719164,45165611,40045,1395,19977,41635693,647,28635440,36469112,36039852,45165643,45165639,42869132,49079051,36290345,38291614,6565604,45925472,45293539,44222381,52148105,39902145,24741921,23421,34483723,2181,2001,37841462,24655410,25826872,13961580,32086995,3784,743,43270969,40375209,
	song_ids = [ 2220,44701355,42980052,17257,41202817,39880252,37107179,39640846,51887659,42489815,42188135,35029749,33517263,51945,438,5361417,34082793,10330,25825501,43022206,40375210,4133,33246372,45180951,1807,42192134,42187997,15179,52004956,41185267,52305254,3778,38073972,49632662,33227697,44815546,39640854,376617,37681305,39692426,18383998,35551927,42282836,45495712,49632259,43625516,47398503,42893484,51537510,49242572,41801782,38270342,42893605,50891824,37472388,44798717,18351,1801573,316646,3789,40417236,1747,49995310,18327,39425,53048565,34322712,635,5278864,42793159,44120620,39640850,45759398,39345482,37056106,3070,44646160,2281574,40034505,24326612,36145359,43038645,42432973,52654692,24527233,41942551,32769669,43075560,30004620,6527,1256,37301247,36465164,146784,40537211,393,42067187,39640984,18591979,37846477,38615049,1306,488,46076238,44222366,424,17894,30399406,48405664,44005347,42170551,50133741,26073234,42323791,35752942,39653319,51906898,50957556,523,37278013,44815190,24615113,38620309,8285607,708,43157169,51500064,52059919,41938025,5917,50545140,2394324,37487765,38852495,45409435,52147241,43057346,45929160,44222367,35175100,43039082,2391018,51973777,44928428,289382,52788181,46410523,431,35134073,11835354,42416796,5916,32378504,36412466,43911493,37681234,34219789,42675615,38216877,455,45312281,328984,29173768,40374369,46397762,664,45165646,44955519,29851256,40375236,49262921,52008681,37207845,23335,36975350,49632240,43381759,21999,1473,45105454,41184818,42675713,490,48284461,37632371,41635695,51458092,44222365,20099,43022359,18114,24428101,26168,43462559,33599876,34955398,49995309,48284480,42573626,29324678,24374253,41185275,1286,50112496,11917918,1886,39653300,34666331,41938178,41867472,44824251,43962946,32195490,35368321,2390431,356890,41228728,442,51358923,6358,36757546,50281684,49404164,26068243,41707977,44338183,3212,49404020,1447,43131369,6832475,41687926,52467042,42456355,43657992,1887,42657152,39586957,24711388,42170922,44222441,38667224,42416873,12060080,49242976,20059086,32167491,45312176,44239124,418,1607389,19357,2388054,35087154,39594977,20435,45165644,32769511,52001033,36857408,44829432,52279152,452,36829289,2219781,49830371,50704,49263403,38053537,36200021,33792278,42048046,394,50776008,7087,53578659,39640847,39958446,33396499,1820174,43038644,48873154,40663959,23248,19602257,379,34320875,42188067,45165645,48410822,26268 ]
	#song_ids = [  52467171 ]

	for song_id in song_ids:
		data = buzzAngle(song_id)
		print(data)
		with open('temp.json', 'w') as outfile:
			json.dump(data, outfile)
		time.sleep(1)
		call("keen events:add -c historicalTop500 --file ./temp.json", shell=True)

	return

main()
